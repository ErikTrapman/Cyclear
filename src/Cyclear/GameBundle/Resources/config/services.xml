<?xml version="1.0" ?>
<!-- 100 => 'DEBUG', 200 => 'INFO', 300 => 'WARNING', 400 => 'ERROR', 500 
=> 'CRITICAL', 550 => 'ALERT', -->
<container xmlns="http://symfony.com/schema/dic/services"
           xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:monolog="http://symfony.com/schema/dic/monolog"
           xsi:schemaLocation="http://symfony.com/schema/dic/services http://symfony.com/schema/dic/services/services-1.0.xsd
    		http://symfony.com/schema/dic/monolog http://symfony.com/schema/dic/monolog/monolog-1.0.xsd">

    <services>

        <service id="cyclear_game.requestlistener" class="Cyclear\GameBundle\Listener\RequestListener">
            <argument type="service" id="doctrine.orm.entity_manager"/>
            <argument type="service" id="security.token_storage"/>
            <tag name="kernel.event_listener" event="kernel.request" method="onKernelRequest"/>
        </service>

        <service id="cyclear_game.doctrine.listener.transfer"
                 class="Cyclear\GameBundle\Listener\Doctrine\TransferListener">
            <tag name="doctrine.event_listener" event="postPersist"/>
            <argument type="service" id="cyclear_game.twitter.tweeter"/>
            <argument type="service" id="translator"/>
        </service>

        <service id="pdo" class="PDO">
            <argument key="dsn">mysql:dbname=%database_name%;host=%database_host%</argument>
            <argument key="user">%database_user%</argument>
            <argument key="pass">%database_password%</argument>
        </service>

        <service id="cyclear_game.manager.transfer" class="Cyclear\GameBundle\EntityManager\TransferManager">
            <argument type="service" id="doctrine.orm.entity_manager"/>
            <argument type="service" id="cyclear_game.manager.contract"/>
            <argument>%max_transfers%</argument>
        </service>

        <service id="cyclear_game.manager.wedstrijd" class="Cyclear\GameBundle\EntityManager\WedstrijdManager">
            <argument type="service" id="eriktrapman_cqparser.parser"/>
        </service>

        <service id="cyclear_game.manager.uitslag" class="Cyclear\GameBundle\EntityManager\UitslagManager">
            <argument type="service" id="doctrine.orm.entity_manager"/>
            <argument type="service" id="eriktrapman_cqparser.parser"/>
            <argument type="service" id="cyclear_game.calculator.punten"/>
            <argument>%cq_ranking-wedstrijdurl%</argument>
            <argument type="service" id="cyclear_game.manager.renner"/>
            <argument type="service" id="eriktrapman_cqparser.nationality_resolver"/>
            <argument type="service" id="eriktrapman_cqparser.twitterparser"/>
        </service>

        <service id="cyclear_game.manager.renner" class="Cyclear\GameBundle\EntityManager\RennerManager"/>

        <service id="cyclear_game.manager.user" class="Cyclear\GameBundle\EntityManager\UserManager">
            <argument type="service" id="security.acl.provider"/>
        </service>

        <service id="cyclear_game.manager.contract" class="Cyclear\GameBundle\EntityManager\ContractManager">
            <argument type="service" id="doctrine.orm.entity_manager"/>
        </service>

        <service id="cyclear_game.type.renner_selector" class="Cyclear\GameBundle\Form\RennerSelectorType">
            <argument type="service" id="doctrine.orm.entity_manager"/>
            <argument type="service" id="cyclear_game.manager.renner"/>
            <argument type="service" id="router"/>
            <tag name="form.type" alias="renner_selector"/>
        </service>

        <service id="cyclear_game.type.seizoen_selector" class="Cyclear\GameBundle\Form\SeizoenSelectorType">
            <argument type="service" id="doctrine.orm.entity_manager"/>
            <tag name="form.type" alias="seizoen_selector"/>
        </service>

        <service id="cyclear_game.type.filter.ploeg" class="Cyclear\GameBundle\Form\Filter\PloegFilterType">
            <argument type="service" id="doctrine.orm.entity_manager"/>
            <tag name="form.type" alias="ploeg_filter"/>
        </service>

        <service id="cyclear_game.type.filter.renner" class="Cyclear\GameBundle\Form\Filter\RennerFilterType">
            <tag name="form.type" alias="renner_filter"/>
        </service>

        <service id="cyclear_game.type.filter.renner_id" class="Cyclear\GameBundle\Form\Filter\RennerIdFilterType">
            <tag name="form.type" alias="renner_id_filter"/>
        </service>

        <service id="cyclear_game.calculator.punten" class="Cyclear\GameBundle\Calculator\PuntenCalculator">
            <argument type="service" id="doctrine.orm.entity_manager"/>
        </service>


        <service id="crawler" class="Symfony\Component\DomCrawler\Crawler"/>
        <!-- FOS User Bundle -->
        <service id="cyclear_game.user_registration.form.type" class="Cyclear\GameBundle\Form\UserType">
            <tag name="form.type" alias="admin_user_new"/>
            <argument>%fos_user.model.user.class%</argument>
        </service>
        <service id="cyclear_game.user_edit.form.type" class="Cyclear\GameBundle\Form\UserEditType">
            <tag name="form.type" alias="admin_user_edit"/>
            <argument>%fos_user.model.user.class%</argument>
        </service>


        <service id="cyclear_game.validator.usertransfer"
                 class="Cyclear\GameBundle\Validator\Constraints\UserTransferValidator">
            <argument type="service" id="doctrine.orm.default_entity_manager"/>
            <tag name="validator.constraint_validator" alias="user_transfer"/>
        </service>

        <service
                decorates="cyclear_game.validator.usertransfer"
                id="cyclear_game.validator.fixedusertransfer"
                class="Cyclear\GameBundle\Validator\Constraints\UserTransferFixedValidator">
            <argument type="service" id="doctrine.orm.default_entity_manager"/>
            <argument>%max_transfers%</argument>
            <tag name="validator.constraint_validator" alias="user_transfer"/>
        </service>

        <service id="cyclear_game.fos_user.password_reset"
                 class="Cyclear\GameBundle\Listener\FOSUser\PasswordResetListener">
            <argument type="service" id="router"/>
            <tag name="kernel.event_subscriber"/>
        </service>

        <service id="cyclear_game.twitter.helper" class="TijsVerkoyen\Twitter\Twitter">
            <argument>%twitter_consumer_key%</argument>
            <argument>%twitter_consumer_secret%</argument>
            <call method="setOAuthToken">
                <argument>%twitter_oauth_token%</argument>
            </call>
            <call method="setOAuthTokenSecret">
                <argument>%twitter_oauth_secret%</argument>
            </call>
        </service>

        <service id="cyclear_game.twitter.tweeter" class="Cyclear\GameBundle\Twitter\Tweeter">
            <argument type="service" id="cyclear_game.twitter.helper"/>
            <argument type="service" id="service_container"/>
        </service>

        <service class="Cyclear\GameBundle\CQ\RaceCategoryMatcher"
                 id="cyclear_game.cq.race_category_matcher">
            <argument id="doctrine.orm.default_entity_manager" type="service"/>
        </service>


        <service class="Cyclear\GameBundle\CQ\CQAutomaticResultsResolver"
                 id="cyclear_game.cq.cqautomatic_results_resolver">
            <argument id="doctrine.orm.default_entity_manager" type="service"/>
            <argument id="cyclear_game.cq.race_category_matcher" type="service"/>
            <argument id="cyclear_game.manager.uitslag" type="service"/>
            <argument id="eriktrapman_cqparser.crawler_manager" type="service"/>
            <argument id="cyclear_game.transformer.rennername_rennerid" type="service"/>
            <argument id="logger" type="service"/>
        </service>

        <service
                class="Cyclear\GameBundle\Form\DataTransformer\RennerNameToRennerIdTransformer"
                id="cyclear_game.transformer.rennername_rennerid">
            <argument id="doctrine.orm.default_entity_manager" type="service"/>
            <argument type="service" id="cyclear_game.manager.renner"/>
        </service>

        <service class="Cyclear\GameBundle\Twig\SecurityExtension"
                 id="cyclear_game.twig.security_extension">
            <argument id="doctrine.orm.default_entity_manager" type="service"/>
            <argument id="security.authorization_checker" type="service"/>
            <argument id="request_stack" type="service"/>
            <tag name="twig.extension"/>
        </service>


    </services>

    <!-- <parameters> <parameter key="cyclear_game.example.class">Cyclear\GameBundle\Example</parameter> 
  		</parameters> <services> <service id="cyclear_game.example" class="%cyclear_game.example.class%"> 
  		<argument type="service" id="service_id" /> <argument>plain_value</argument> 
  		<argument>%parameter_name%</argument> </service> </services> -->
</container>
